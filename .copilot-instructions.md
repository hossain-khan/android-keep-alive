# Copilot Instructions for Android Keep Alive Project

## Project Overview
This is an Android application that keeps specified apps alive by monitoring and automatically restarting them when they're not running. The app uses foreground services and requires several sensitive permissions to function properly.

**⚠️ Important**: This app is mostly AI-generated code and doesn't follow all Android best practices. See CONTRIBUTING.md for details.

## Architecture and Technologies

### Core Technologies
- **Language**: Kotlin
- **UI Framework**: Jetpack Compose with Material3 design
- **Build System**: Gradle with Kotlin DSL
- **Minimum SDK**: 28 (Android 9.0)
- **Target SDK**: 34 (Do NOT target API 35 - it breaks foreground service functionality)

### Architecture Patterns
- **Repository Pattern**: `SettingsRepository` for data management
- **MVVM**: ViewModels with Compose UI
- **DataStore**: For persistent app preferences
- **Foreground Services**: `WatchdogService` for background monitoring

### Key Dependencies
- AndroidX Compose BOM and libraries
- AndroidX Navigation Compose
- AndroidX DataStore Preferences
- OkHttp for network requests
- Timber for logging
- Kotlinx Serialization

## Code Style and Guidelines

### Formatting
- Uses ktlint for code formatting with Android-specific rules
- Run `./gradlew ktlintCheck` before committing
- Auto-format with `./gradlew ktlintFormat`

### File Structure
```
app/src/main/java/dev/hossain/keepalive/
├── MainActivity.kt - Main entry point
├── MainViewModel.kt - Main screen logic
├── KeepAliveApplication.kt - Application class
├── service/
│   └── WatchdogService.kt - Core monitoring service
├── ui/screen/ - Compose UI screens
├── data/ - Data layer with repositories and models
└── util/ - Utility classes and constants
```

## Important Constraints and Considerations

### API Level Restrictions
- **Do NOT target API 35**: It breaks the SYSTEM_ALERT_WINDOW permission exemption for foreground services
- Current target: API 34 (Android 14)

### Required Permissions
The app requires these sensitive permissions:
- `SYSTEM_ALERT_WINDOW` - For overlay functionality
- `FOREGROUND_SERVICE` - For watchdog service
- `FOREGROUND_SERVICE_SPECIAL_USE` - Special foreground service use cases
- `RECEIVE_BOOT_COMPLETED` - Auto-start after device boot
- `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS` - Prevent system battery optimization
- `POST_NOTIFICATIONS` - Show notifications
- `QUERY_ALL_PACKAGES` - Access all installed packages

### Build Configuration
- Uses signing configs from `secret.properties` (fallback to `secret.template.properties`)
- ProGuard disabled for release builds
- Java 8 compatibility (sourceCompatibility/targetCompatibility)

## Development Workflow

### Building
```bash
# Debug build with lint check
./gradlew :app:ktlintCheck :app:assembleDebug

# Full clean build
./gradlew clean build
```

### Testing
- Unit tests with JUnit 4
- Android instrumented tests with Espresso
- Compose UI tests

### CI/CD
- GitHub Actions workflow in `.github/workflows/android.yml`
- Runs on pushes and PRs to main branch
- Uses JDK 21 and caches Gradle dependencies

## Common Development Tasks

### Adding New Features
1. Follow the existing repository pattern in `data/` package
2. Create Compose UI in `ui/screen/` package
3. Update navigation in MainActivity if needed
4. Add appropriate tests
5. Run ktlint formatting

### Working with Settings
- Use `SettingsRepository` for all app preferences
- Settings are stored using DataStore Preferences
- UI reflects settings changes via StateFlow

### Modifying Watchdog Service
- The `WatchdogService` is the core functionality
- It runs as a foreground service with notification
- Be careful with API level changes that affect foreground services

## Remote Logging Feature
The app includes optional remote logging to Airtable:
- Configurable via `AppAdditionalConfigs` screen
- Uses Airtable API with personal access token
- Logs app activity and monitoring events

## Debugging Tips
- Use Timber for logging: `Timber.d("message")`
- Check foreground service status in Android settings
- Monitor battery optimization settings
- Test with different API levels (but don't target 35+)

## Dependencies Management
- All versions managed in `gradle/libs.versions.toml`
- Use version catalog for consistency
- Prefer AndroidX libraries over support libraries
- Keep dependencies minimal and focused

When contributing or making changes, always test the core functionality: the app should successfully monitor and restart selected apps while running as a foreground service.